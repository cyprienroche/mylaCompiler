# Gradle CircleCI 2.0 configuration file
#
# Check https://circleci.com/docs/2.0/language-java/ for more details
#          
 version: 2.0
 defaults: &defaults
   working_directory: ~/repo
   docker:
     - image: circleci/openjdk:11-jdk
 jobs:
   build:
     <<: *defaults
     steps:
       - checkout
       - run: gradle assemble
   test:
     <<: *defaults
     steps:
       - checkout
       - run: gradle test
       - run:
           name: Save test results
           command: |
             mkdir -p ~/test-results/junit/
             find . -type f -regex ".*/build/test-results/.*xml" -exec cp {} ~/test-results/junit/ \;
           when: always
       - store_test_results:
           path: ~/test-results
       - store_artifacts:
           path: ~/test-results/junit
   checkstyle:
     <<: *defaults
     steps:
       - checkout
       - run: gradle lintKotlinTest
   install:
     <<: *defaults
     steps:
       - checkout
       - run: gradle installDist
       
 workflows:
   version: 2
   build-test-checkstyle:
     jobs:
       - build
       - test:
           requires:
             - build
       - checkstyle:
           requires:
               - build
       - install:
           requires:
             - test
             - checkstyle
